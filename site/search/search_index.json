{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"OGC API da DGT - Manual de Administra\u00e7\u00e3o Este manual destina-se a compreender e gerir a infraestrutura de dados OGCAPI da DGT, e o servidor onde ela se encontra instalada. S\u00e3o bem vindas contribui\u00e7\u00f5es para este manual, atrav\u00e9s dos mecanismos descritos nesta sec\u00e7\u00e3o .","title":"In\u00edcio"},{"location":"#ogc-api-da-dgt-manual-de-administracao","text":"Este manual destina-se a compreender e gerir a infraestrutura de dados OGCAPI da DGT, e o servidor onde ela se encontra instalada. S\u00e3o bem vindas contribui\u00e7\u00f5es para este manual, atrav\u00e9s dos mecanismos descritos nesta sec\u00e7\u00e3o .","title":"OGC API da DGT - Manual de Administra\u00e7\u00e3o"},{"location":"arquitectura/","text":"Arquitectura do Sistema A arquitectura do sistema, definida no ficheiro de configura\u00e7\u00e3o do docker compose , articula os v\u00e1rios servi\u00e7os que comp\u00f5em a IDE. No centro, est\u00e1 a pygeoapi , uma API de python que implementa v\u00e1rios Standards OGC API. Os servi\u00e7os podem ser divididos em v\u00e1rios grupos: Base de dados geospacial. Servi\u00e7os de Tiles. Servi\u00e7os de monitoriza\u00e7\u00e3o de logs. Servi\u00e7os que monitorizam outros servi\u00e7os. Os servi\u00e7os expostos \u00e0 Internet s\u00e3o publicados por um servidor de web ( apache ), que funciona como um proxy. \u00c9 tamb\u00e9m este servidor que faz a gest\u00e3o dos certificados SSL. Actualmente o servidor exp\u00f5e tr\u00eas sub-dom\u00ednios, que d\u00e3o acesso a tr\u00eas servi\u00e7os deste sistema: ogcapi.dgterritorio.gov.pt -> API com OGCAPI (pygeoapi). logs.dgterritorio.gov.pt -> monitoriza\u00e7\u00e3o de logs (matomo). logs.dgterritorio.gov.pt -> monitoriza\u00e7\u00e3o de servi\u00e7os (GeoHealthCheck). Mais detalhes sobre a configura\u00e7\u00e3o do apache podem ser encontrados neste ficheiro. Nos pr\u00f3ximos par\u00e1grafos, os servi\u00e7os s\u00e3o descritos com maior detalhe. Bases de dados geospacial A Base de Dados (BD) utilizada para guardar os dados geospaciais est\u00e1 no servi\u00e7o postgis . Na altura em que foi escrito este manual este servi\u00e7o tem um servidor PostgreSQL 15.0 com PostGIS 3.5.2. Quando o sistema inicia, um servi\u00e7o chamado db_and_api_init \u00e9 respons\u00e1vel por carregar os dados, em formatos diversos como Shapefile ou GeoPackage, na directoria \\data . Para al\u00e9m de pr\u00e9-processar e carregar esses dados, este servi\u00e7o tamb\u00e9m cria as vistas necess\u00e1rias na BD, e os ficheiros de configura\u00e7\u00e3o para a pygeoapi. Info Nem todas as colec\u00e7\u00f5es publicadas pela pygeoapi se encontram guardadas nesta BD. Este sistema usa tamb\u00e9m alguns dados que est\u00e3o guardados em BD externas (fora desta composi\u00e7\u00e3o e fora desta m\u00e1quina). Os endere\u00e7os desses servidores, assim como outros par\u00e2metros de conex\u00e3o s\u00e3o injectados no ficheiro de configura\u00e7\u00e3o da pygeoapi atrav\u00e9s de vari\u00e1veis ambientais. Essas vari\u00e1veis ambientais est\u00e3o descritas num ficheiro .env , que se encontra na raiz da directoria onde se encontra o ficheiro de docker compose. Servi\u00e7os de Tiles As tiles vectoriais s\u00e3o publicadas pela aplica\u00e7\u00e3o martin , que permite servir estes dados directamente a partir de tabelas de PostGIS. Para acelerar a performance, usaram-se Materialized Views no lugar de views, e criaram-se \u00edndices geospaciais e \u00edndices \u00fanicos para todas as vistas e tabelas. Como cada inst\u00e2ncia de martin fica assignada a uma BD, foram criadas tr\u00eas inst\u00e2ncias diferentes, assignadas a cada uma das BD usadas para guardar dados geospaciais: Servi\u00e7o tiles : publica tiles a partir de tabelas na base de dados geospacial . Servi\u00e7o tiles-inspire : publica tiles a partir de uma tabela com o cadastro, na BD inspire (externa). Servi\u00e7o tiles-caop : publica tiles a partir de tabelas na BD caop (externa). Warning O martin l\u00ea as tabelas da BD quando inicia. Por esse motivo, se forem adicionadas novas tabelas na BD, o martin n\u00e3o ir\u00e1 publicar-las at\u00e9 que o servidor seja reiniciado. Servi\u00e7os de Monitoriza\u00e7\u00e3o de Logs Os logs do servidor web (e.g. Apache) s\u00e3o monitorizados usando o matomo , uma alternativa ao Google Analytics que protege os dados e a privacidade dos utilizadores. O servi\u00e7o matomo corresponde \u00e1 aplica\u00e7\u00e3o matomo, cujos dados s\u00e3o guardados no servi\u00e7o de mariadb . Finalmente, o python_matomo \u00e9 um servi\u00e7o de suporte que faz a ingest\u00e3o dos logs do Apache atrav\u00e9s de um cron job. O matomo est\u00e1 configurado para monitorizar o website ogcapi.dgterritorio.gov.pt , apresentando uma dashboard com m\u00e9tricas como o n\u00famero de visitantes ou os endpoints visitados, e ainda o mapa com a origem dos visitantes. A informa\u00e7\u00e3o de como usar o matomo est\u00e1 dispon\u00edvel no guia do utilizador . Warning O python_matomo l\u00ea os logs do Apache, atrav\u00e9s de um volume partilhado entre os containers. No caso de se mudar este container para uma outra m\u00e1quina, seria necess\u00e1rio assegurar que se continua a ter acesso aos logs do Apache (por exemplo atrav\u00e9s de uma directoria de rede montada). Info Em pr\u00edncipio os dados do matomo s\u00e3o persistidos na pasta ./matomo/data/matomo , mesmo que containers e respectivos volumes sejam apagados. No caso de se migrar o servidor para outra m\u00e1quina, \u00e9 importante copiar essa directoria (tal como a BD), para que n\u00e3o se perca o hist\u00f3rico de logs do matomo. Servi\u00e7os que Monitorizam outros Servi\u00e7os Os servi\u00e7os OGC API, publicados pela pygeoapi s\u00e3o monitorizados usando o GeoHealthCheck (GHC), um monitor de QoS (Quality of Service) para servi\u00e7os geospaciais. O GHC \u00e9 constitu\u00eddo pelo servi\u00e7o de backend - gc_runner e a aplica\u00e7\u00e3o de web ghc_web . Os dados s\u00e3o persistidos numa BD SQLite . Na altura de escrita deste manual, o GHC est\u00e1 configurado para monitorizar um endpoint de OGC API - Features, mas outros endpoints (incluindo servi\u00e7os OWS) podem ser adicionados. A informa\u00e7\u00e3o sobre como configurar e usar o GHC est\u00e1 dispon\u00edvel na documenta\u00e7\u00e3o oficial do projeto . Tip Devido \u00e1 configura\u00e7\u00e3o da rede, o container ghc n\u00e3o consegue aceder ao container apache pelo IP externo. Para ultrapassar esse problema, pode-se associar o IP de intranet do apache ao DNS, no ficheiro /etc/localhosts . Estes s\u00e3o os passos para executar essa ac\u00e7\u00e3o, a partir da m\u00e1quina onde est\u00e1 a correr a composi\u00e7\u00e3o de docker: Entrar no container ghc_web : docker exec -it ghc_web bash Instalar o ping (iputils-ping) e o nano: apt-get update && apt-get install iputils-ping nano -y Fazer ping container do apache para obter o seu endere\u00e7o de IP na intranet: ping httpd Adicionar este IP ao ficheiro /etc/hosts, fazendo-o apontar para ogcapi.dgterritorio.gov.pt : echo \"172.19.0.12 ogcapi.dgterritorio.gov.pt\" >> /etc/hosts ( substituir 172.19.0.12 pelo IP identificado no passo anterior! ) Confirmar que o ping para ogcapi.dgterritorio.gov.pt retorna o IP de intranet do Apache: ping ogcapi.dgterritorio.gov.pt . Em caso afirmativo, n\u00e3o \u00e9 preciso fazer mais nada. Ser\u00e1 necess\u00e1rio executar estes passos, de cada vez que houver um restart do servidor!","title":"Arquitectura do Sistema"},{"location":"arquitectura/#arquitectura-do-sistema","text":"A arquitectura do sistema, definida no ficheiro de configura\u00e7\u00e3o do docker compose , articula os v\u00e1rios servi\u00e7os que comp\u00f5em a IDE. No centro, est\u00e1 a pygeoapi , uma API de python que implementa v\u00e1rios Standards OGC API. Os servi\u00e7os podem ser divididos em v\u00e1rios grupos: Base de dados geospacial. Servi\u00e7os de Tiles. Servi\u00e7os de monitoriza\u00e7\u00e3o de logs. Servi\u00e7os que monitorizam outros servi\u00e7os. Os servi\u00e7os expostos \u00e0 Internet s\u00e3o publicados por um servidor de web ( apache ), que funciona como um proxy. \u00c9 tamb\u00e9m este servidor que faz a gest\u00e3o dos certificados SSL. Actualmente o servidor exp\u00f5e tr\u00eas sub-dom\u00ednios, que d\u00e3o acesso a tr\u00eas servi\u00e7os deste sistema: ogcapi.dgterritorio.gov.pt -> API com OGCAPI (pygeoapi). logs.dgterritorio.gov.pt -> monitoriza\u00e7\u00e3o de logs (matomo). logs.dgterritorio.gov.pt -> monitoriza\u00e7\u00e3o de servi\u00e7os (GeoHealthCheck). Mais detalhes sobre a configura\u00e7\u00e3o do apache podem ser encontrados neste ficheiro. Nos pr\u00f3ximos par\u00e1grafos, os servi\u00e7os s\u00e3o descritos com maior detalhe.","title":"Arquitectura do Sistema"},{"location":"arquitectura/#bases-de-dados-geospacial","text":"A Base de Dados (BD) utilizada para guardar os dados geospaciais est\u00e1 no servi\u00e7o postgis . Na altura em que foi escrito este manual este servi\u00e7o tem um servidor PostgreSQL 15.0 com PostGIS 3.5.2. Quando o sistema inicia, um servi\u00e7o chamado db_and_api_init \u00e9 respons\u00e1vel por carregar os dados, em formatos diversos como Shapefile ou GeoPackage, na directoria \\data . Para al\u00e9m de pr\u00e9-processar e carregar esses dados, este servi\u00e7o tamb\u00e9m cria as vistas necess\u00e1rias na BD, e os ficheiros de configura\u00e7\u00e3o para a pygeoapi. Info Nem todas as colec\u00e7\u00f5es publicadas pela pygeoapi se encontram guardadas nesta BD. Este sistema usa tamb\u00e9m alguns dados que est\u00e3o guardados em BD externas (fora desta composi\u00e7\u00e3o e fora desta m\u00e1quina). Os endere\u00e7os desses servidores, assim como outros par\u00e2metros de conex\u00e3o s\u00e3o injectados no ficheiro de configura\u00e7\u00e3o da pygeoapi atrav\u00e9s de vari\u00e1veis ambientais. Essas vari\u00e1veis ambientais est\u00e3o descritas num ficheiro .env , que se encontra na raiz da directoria onde se encontra o ficheiro de docker compose.","title":"Bases de dados geospacial"},{"location":"arquitectura/#servicos-de-tiles","text":"As tiles vectoriais s\u00e3o publicadas pela aplica\u00e7\u00e3o martin , que permite servir estes dados directamente a partir de tabelas de PostGIS. Para acelerar a performance, usaram-se Materialized Views no lugar de views, e criaram-se \u00edndices geospaciais e \u00edndices \u00fanicos para todas as vistas e tabelas. Como cada inst\u00e2ncia de martin fica assignada a uma BD, foram criadas tr\u00eas inst\u00e2ncias diferentes, assignadas a cada uma das BD usadas para guardar dados geospaciais: Servi\u00e7o tiles : publica tiles a partir de tabelas na base de dados geospacial . Servi\u00e7o tiles-inspire : publica tiles a partir de uma tabela com o cadastro, na BD inspire (externa). Servi\u00e7o tiles-caop : publica tiles a partir de tabelas na BD caop (externa). Warning O martin l\u00ea as tabelas da BD quando inicia. Por esse motivo, se forem adicionadas novas tabelas na BD, o martin n\u00e3o ir\u00e1 publicar-las at\u00e9 que o servidor seja reiniciado.","title":"Servi\u00e7os de Tiles"},{"location":"arquitectura/#servicos-de-monitorizacao-de-logs","text":"Os logs do servidor web (e.g. Apache) s\u00e3o monitorizados usando o matomo , uma alternativa ao Google Analytics que protege os dados e a privacidade dos utilizadores. O servi\u00e7o matomo corresponde \u00e1 aplica\u00e7\u00e3o matomo, cujos dados s\u00e3o guardados no servi\u00e7o de mariadb . Finalmente, o python_matomo \u00e9 um servi\u00e7o de suporte que faz a ingest\u00e3o dos logs do Apache atrav\u00e9s de um cron job. O matomo est\u00e1 configurado para monitorizar o website ogcapi.dgterritorio.gov.pt , apresentando uma dashboard com m\u00e9tricas como o n\u00famero de visitantes ou os endpoints visitados, e ainda o mapa com a origem dos visitantes. A informa\u00e7\u00e3o de como usar o matomo est\u00e1 dispon\u00edvel no guia do utilizador . Warning O python_matomo l\u00ea os logs do Apache, atrav\u00e9s de um volume partilhado entre os containers. No caso de se mudar este container para uma outra m\u00e1quina, seria necess\u00e1rio assegurar que se continua a ter acesso aos logs do Apache (por exemplo atrav\u00e9s de uma directoria de rede montada). Info Em pr\u00edncipio os dados do matomo s\u00e3o persistidos na pasta ./matomo/data/matomo , mesmo que containers e respectivos volumes sejam apagados. No caso de se migrar o servidor para outra m\u00e1quina, \u00e9 importante copiar essa directoria (tal como a BD), para que n\u00e3o se perca o hist\u00f3rico de logs do matomo.","title":"Servi\u00e7os de Monitoriza\u00e7\u00e3o de Logs"},{"location":"arquitectura/#servicos-que-monitorizam-outros-servicos","text":"Os servi\u00e7os OGC API, publicados pela pygeoapi s\u00e3o monitorizados usando o GeoHealthCheck (GHC), um monitor de QoS (Quality of Service) para servi\u00e7os geospaciais. O GHC \u00e9 constitu\u00eddo pelo servi\u00e7o de backend - gc_runner e a aplica\u00e7\u00e3o de web ghc_web . Os dados s\u00e3o persistidos numa BD SQLite . Na altura de escrita deste manual, o GHC est\u00e1 configurado para monitorizar um endpoint de OGC API - Features, mas outros endpoints (incluindo servi\u00e7os OWS) podem ser adicionados. A informa\u00e7\u00e3o sobre como configurar e usar o GHC est\u00e1 dispon\u00edvel na documenta\u00e7\u00e3o oficial do projeto . Tip Devido \u00e1 configura\u00e7\u00e3o da rede, o container ghc n\u00e3o consegue aceder ao container apache pelo IP externo. Para ultrapassar esse problema, pode-se associar o IP de intranet do apache ao DNS, no ficheiro /etc/localhosts . Estes s\u00e3o os passos para executar essa ac\u00e7\u00e3o, a partir da m\u00e1quina onde est\u00e1 a correr a composi\u00e7\u00e3o de docker: Entrar no container ghc_web : docker exec -it ghc_web bash Instalar o ping (iputils-ping) e o nano: apt-get update && apt-get install iputils-ping nano -y Fazer ping container do apache para obter o seu endere\u00e7o de IP na intranet: ping httpd Adicionar este IP ao ficheiro /etc/hosts, fazendo-o apontar para ogcapi.dgterritorio.gov.pt : echo \"172.19.0.12 ogcapi.dgterritorio.gov.pt\" >> /etc/hosts ( substituir 172.19.0.12 pelo IP identificado no passo anterior! ) Confirmar que o ping para ogcapi.dgterritorio.gov.pt retorna o IP de intranet do Apache: ping ogcapi.dgterritorio.gov.pt . Em caso afirmativo, n\u00e3o \u00e9 preciso fazer mais nada. Ser\u00e1 necess\u00e1rio executar estes passos, de cada vez que houver um restart do servidor!","title":"Servi\u00e7os que Monitorizam outros Servi\u00e7os"},{"location":"contribuir/","text":"Contribuir para este Manual Sugest\u00f5es, melhorias e correc\u00e7\u00f5es s\u00e3o sempre bem vindos atrav\u00e9s do reposit\u00f3rio git deste projecto . Para assinalar alguma quest\u00e3o, ou colocar uma d\u00favida, pode ser utilizado o issue tracker do projecto. Para fazer altera\u00e7\u00f5es no conte\u00fado ou estrutura deste manual (por exemplo correc\u00e7\u00f5es no texto, ou adicionar recursos), pode ser criado um Pull Request . Mais detalhes sobre a tecnologia utilizada para criar este manual e a sua licen\u00e7a podem ser encontrados no README do projecto.","title":"Contribuir para este Manual"},{"location":"contribuir/#contribuir-para-este-manual","text":"Sugest\u00f5es, melhorias e correc\u00e7\u00f5es s\u00e3o sempre bem vindos atrav\u00e9s do reposit\u00f3rio git deste projecto . Para assinalar alguma quest\u00e3o, ou colocar uma d\u00favida, pode ser utilizado o issue tracker do projecto. Para fazer altera\u00e7\u00f5es no conte\u00fado ou estrutura deste manual (por exemplo correc\u00e7\u00f5es no texto, ou adicionar recursos), pode ser criado um Pull Request . Mais detalhes sobre a tecnologia utilizada para criar este manual e a sua licen\u00e7a podem ser encontrados no README do projecto.","title":"Contribuir para este Manual"},{"location":"migracao/","text":"Migra\u00e7\u00e3o para outro Servidor Migrar o sistema para outro servidor, implica fazer uma instala\u00e7\u00e3o nova do c\u00f3digo que implementa o sistema descrito em Arquitectura do Sistema . O sistema pode ser descarregado directamente do reposit\u00f3rio de git: git clone https://github.com/byteroad/ogcapi-simple.git Entrar dentro do reposit\u00f3rio: cd ogcapi-simple Antes de serem iniciados os containers (tal como est\u00e1 descrito em Gerir as Aplica\u00e7\u00f5es ), deve ser criado um ficheiro .env , na raiz desse reposit\u00f3rio com as vari\u00e1veis de ambiente. A forma mais simples \u00e9 copiar o ficheiro que est\u00e1 na m\u00e1quina ogcapi. Tamb\u00e9m devem ser copiados os certificados SSL, para a pasta /etc/ssl (ver Substitui\u00e7\u00e3o dos certificados SSL ) Depois, o sistema pode ser iniciado (no background) com: docker compose up -d No caso de ser uma instalac\u00e3o nova, o docker daemon vai puxar a \u00faltima vers\u00e3o das imagens de docker utilizadas e fazer o build das imagens necess\u00e1rias. Info O sistema OGCAPI n\u00e3o tem a no\u00e7\u00e3o de estado, j\u00e1 que \u00e9 recriado de cada vez que \u00e9 iniciado. As mudan\u00e7as s\u00e3o persistidas no c\u00f3digo, permitindo que seja reproduz\u00edvel em outras m\u00e1quinas sem nenhum esfor\u00e7o adicional. No entanto a aplica\u00e7\u00e3o de monitoriza\u00e7\u00e3o de logs ( geohealthcheck ) e a aplica\u00e7\u00e3o de monitoriza\u00e7\u00e3o de servi\u00e7os ( matomo ) guardam dados (e configura\u00e7\u00f5es) que s\u00e3o criados depois do sistema estar em marcha e que portanto n\u00e3o est\u00e3o descritos no c\u00f3digo. Para migrar o matomo, \u00e9 necess\u00e1rio copiar directoria ./matomo/data . O manual de utilizadores do GeoHealthCheck explica como exportar os dados para um ficheiro json e importar-los numa BD nova. Warning Por defeito, o GeoHealthCheck \u00e9 instalado com uma password n\u00e3o segura. Para actualizar a password depois do sistema estar a funcionar, podem ser seguidos estes passos , desde o interior do container. Entrar no container ghc_runner : docker exec -it ghc_runner bash . Entrar pasta GeoHealthCheck : cd GeoHealthCheck/ Criar hash da password: paver create_hash -p mypass (substituir mypass pela password a utilizar) Install sqlite: apt-get update && apt-get install sqlite3 Entrar dentro da BD: sqlite3 DB/data.db Actualizar a password usando o hash criado no passo 3.: UPDATE user SET password = '<above hash-value>' WHERE username == 'myusername'; Sair da BD: '.q'","title":"Migra\u00e7\u00e3o para outro Servidor"},{"location":"migracao/#migracao-para-outro-servidor","text":"Migrar o sistema para outro servidor, implica fazer uma instala\u00e7\u00e3o nova do c\u00f3digo que implementa o sistema descrito em Arquitectura do Sistema . O sistema pode ser descarregado directamente do reposit\u00f3rio de git: git clone https://github.com/byteroad/ogcapi-simple.git Entrar dentro do reposit\u00f3rio: cd ogcapi-simple Antes de serem iniciados os containers (tal como est\u00e1 descrito em Gerir as Aplica\u00e7\u00f5es ), deve ser criado um ficheiro .env , na raiz desse reposit\u00f3rio com as vari\u00e1veis de ambiente. A forma mais simples \u00e9 copiar o ficheiro que est\u00e1 na m\u00e1quina ogcapi. Tamb\u00e9m devem ser copiados os certificados SSL, para a pasta /etc/ssl (ver Substitui\u00e7\u00e3o dos certificados SSL ) Depois, o sistema pode ser iniciado (no background) com: docker compose up -d No caso de ser uma instalac\u00e3o nova, o docker daemon vai puxar a \u00faltima vers\u00e3o das imagens de docker utilizadas e fazer o build das imagens necess\u00e1rias. Info O sistema OGCAPI n\u00e3o tem a no\u00e7\u00e3o de estado, j\u00e1 que \u00e9 recriado de cada vez que \u00e9 iniciado. As mudan\u00e7as s\u00e3o persistidas no c\u00f3digo, permitindo que seja reproduz\u00edvel em outras m\u00e1quinas sem nenhum esfor\u00e7o adicional. No entanto a aplica\u00e7\u00e3o de monitoriza\u00e7\u00e3o de logs ( geohealthcheck ) e a aplica\u00e7\u00e3o de monitoriza\u00e7\u00e3o de servi\u00e7os ( matomo ) guardam dados (e configura\u00e7\u00f5es) que s\u00e3o criados depois do sistema estar em marcha e que portanto n\u00e3o est\u00e3o descritos no c\u00f3digo. Para migrar o matomo, \u00e9 necess\u00e1rio copiar directoria ./matomo/data . O manual de utilizadores do GeoHealthCheck explica como exportar os dados para um ficheiro json e importar-los numa BD nova. Warning Por defeito, o GeoHealthCheck \u00e9 instalado com uma password n\u00e3o segura. Para actualizar a password depois do sistema estar a funcionar, podem ser seguidos estes passos , desde o interior do container. Entrar no container ghc_runner : docker exec -it ghc_runner bash . Entrar pasta GeoHealthCheck : cd GeoHealthCheck/ Criar hash da password: paver create_hash -p mypass (substituir mypass pela password a utilizar) Install sqlite: apt-get update && apt-get install sqlite3 Entrar dentro da BD: sqlite3 DB/data.db Actualizar a password usando o hash criado no passo 3.: UPDATE user SET password = '<above hash-value>' WHERE username == 'myusername'; Sair da BD: '.q'","title":"Migra\u00e7\u00e3o para outro Servidor"},{"location":"recursos/","text":"Refer\u00eancias e Recursos de Aprendizagem Esta sec\u00e7\u00e3o compila as refer\u00eancias e recursos de aprendizagem externos, referentes a algumas tecnologias gen\u00e9ricas descritas neste manual. Para outras tecnologias mais espec\u00edficas (e.g.: Apache, matomo, GeoHealthCheck), s\u00e3o apresentados links directamente no texto onde essa tecnologia \u00e9 mencionada. Linux e Ubuntu Ubuntu Desktop Guide Ubuntu tutorials Linux Journey Material das certifica\u00e7\u00f5es oficiais da Canonical Docker e Docker compose Documenta\u00e7\u00e3o oficial do Docker Docker 101 Tutorial Manual oficial do Docker Compose Git Documenta\u00e7\u00e3o oficial do Git Pro Git Book Documenta\u00e7\u00e3o oficial do GitHub","title":"Refer\u00eancias e Recursos de Aprendizagem"},{"location":"recursos/#referencias-e-recursos-de-aprendizagem","text":"Esta sec\u00e7\u00e3o compila as refer\u00eancias e recursos de aprendizagem externos, referentes a algumas tecnologias gen\u00e9ricas descritas neste manual. Para outras tecnologias mais espec\u00edficas (e.g.: Apache, matomo, GeoHealthCheck), s\u00e3o apresentados links directamente no texto onde essa tecnologia \u00e9 mencionada.","title":"Refer\u00eancias e Recursos de Aprendizagem"},{"location":"recursos/#linux-e-ubuntu","text":"Ubuntu Desktop Guide Ubuntu tutorials Linux Journey Material das certifica\u00e7\u00f5es oficiais da Canonical","title":"Linux e Ubuntu"},{"location":"recursos/#docker-e-docker-compose","text":"Documenta\u00e7\u00e3o oficial do Docker Docker 101 Tutorial Manual oficial do Docker Compose","title":"Docker e Docker compose"},{"location":"recursos/#git","text":"Documenta\u00e7\u00e3o oficial do Git Pro Git Book Documenta\u00e7\u00e3o oficial do GitHub","title":"Git"},{"location":"resolucao/","text":"Resolu\u00e7\u00e3o de Problemas Esta sec\u00e7\u00e3o compila alguns problemas comuns que podem surgir, e as solu\u00e7\u00f5es identificadas. Caso identifiquem outros problemas/solu\u00e7\u00f5es que mere\u00e7am a pena ser adicionados ou actualizados, podem contribuir utilizando os mecanismos identificados nesta sec\u00e7\u00e3o . Question Porque \u00e9 que a colec\u00e7\u00e3o dos ortos, cadastro ou caop deixou de funcionar? Estas colec\u00e7\u00f5es dependem de servidores externos. Devem ser verificados se estes servi\u00e7os est\u00e3o acess\u00edveis: ortos -> https://ortos.dgterritorio.gov.pt/wms/ortosat2023 cadastro -> BD inspire caop -> BD caop Para mais detalhes, consultar o ficheiro de configura\u00e7\u00e3o da pygeoapi . Question Porque \u00e9 que as novas tabelas que foram adicionadas ao PostGIS n\u00e3o est\u00e3o a ser disponibilizadas como tiles? O martin l\u00ea as tabelas da BD quando inicia. Por esse motivo, se forem adicionadas novas tabelas na BD, o martin n\u00e3o ir\u00e1 publicar-las at\u00e9 que o servidor de tiles relevante seja reiniciado. docker compose restart ogcapi-simple-tiles-1 docker compose restart tiles_caop docker compose restart tiles_inspire Mais informa\u00e7\u00f5es sobre o servi\u00e7o martin . Question A m\u00e1quina de Ubuntu foi reiniciada, mas os servi\u00e7os est\u00e3o em baixo. Como iniciar-los? Se por algum motivo os servi\u00e7os estiverem em baixo, as aplicac\u00f5es podem ser iniciadas seguindo as instruc\u00f5es nesta sec\u00e7\u00e3o Question A monitoriza\u00e7\u00e3o de servi\u00e7os indica que eles n\u00e3o est\u00e3o a funcionar, quando na realidade est\u00e3o. Como resolver esta situa\u00e7\u00e3o? o geohealthcheck perdeu as configura\u00e7\u00f5es do /etc/hosts (por exemplo com um restart da m\u00e1quina) e n\u00e3o consegue aceder ao IP da OGC API. Os passos para resolver esta situa\u00e7\u00e3o est\u00e3o explicados aqui .","title":"Resolu\u00e7\u00e3o de Problemas"},{"location":"resolucao/#resolucao-de-problemas","text":"Esta sec\u00e7\u00e3o compila alguns problemas comuns que podem surgir, e as solu\u00e7\u00f5es identificadas. Caso identifiquem outros problemas/solu\u00e7\u00f5es que mere\u00e7am a pena ser adicionados ou actualizados, podem contribuir utilizando os mecanismos identificados nesta sec\u00e7\u00e3o . Question Porque \u00e9 que a colec\u00e7\u00e3o dos ortos, cadastro ou caop deixou de funcionar? Estas colec\u00e7\u00f5es dependem de servidores externos. Devem ser verificados se estes servi\u00e7os est\u00e3o acess\u00edveis: ortos -> https://ortos.dgterritorio.gov.pt/wms/ortosat2023 cadastro -> BD inspire caop -> BD caop Para mais detalhes, consultar o ficheiro de configura\u00e7\u00e3o da pygeoapi . Question Porque \u00e9 que as novas tabelas que foram adicionadas ao PostGIS n\u00e3o est\u00e3o a ser disponibilizadas como tiles? O martin l\u00ea as tabelas da BD quando inicia. Por esse motivo, se forem adicionadas novas tabelas na BD, o martin n\u00e3o ir\u00e1 publicar-las at\u00e9 que o servidor de tiles relevante seja reiniciado. docker compose restart ogcapi-simple-tiles-1 docker compose restart tiles_caop docker compose restart tiles_inspire Mais informa\u00e7\u00f5es sobre o servi\u00e7o martin . Question A m\u00e1quina de Ubuntu foi reiniciada, mas os servi\u00e7os est\u00e3o em baixo. Como iniciar-los? Se por algum motivo os servi\u00e7os estiverem em baixo, as aplicac\u00f5es podem ser iniciadas seguindo as instruc\u00f5es nesta sec\u00e7\u00e3o Question A monitoriza\u00e7\u00e3o de servi\u00e7os indica que eles n\u00e3o est\u00e3o a funcionar, quando na realidade est\u00e3o. Como resolver esta situa\u00e7\u00e3o? o geohealthcheck perdeu as configura\u00e7\u00f5es do /etc/hosts (por exemplo com um restart da m\u00e1quina) e n\u00e3o consegue aceder ao IP da OGC API. Os passos para resolver esta situa\u00e7\u00e3o est\u00e3o explicados aqui .","title":"Resolu\u00e7\u00e3o de Problemas"},{"location":"tarefas/","text":"Tarefas de Manuten\u00e7\u00e3o Esta sec\u00e7\u00e3o descreve algumas tarefas comuns de manuten\u00e7\u00e3o do servidor e da aplica\u00e7\u00e3o. Danger A leitura desta sec\u00e7\u00e3o n\u00e3o substitui a aprendizagem de como gerir uma m\u00e1quina de linux, e como usar docker, docker compose ou git. S\u00e3o providenciados alguns recursos sobre este tema na sec\u00e7\u00e3o Refer\u00eancias e Recursos de Aprendizagem . Manuten\u00e7\u00e3o do Servidor O servidor dever\u00e1 ser actualizado de forma regular, seguindo as boas pr\u00e1ticas de gest\u00e3o de uma m\u00e1quina de Linux: sudo apt-get update sudo apt-get upgrade Algumas actualiza\u00e7\u00f5es updates podem requerer o restart da m\u00e1quina. Warning As LTS proporcionam 5 anos de actualiza\u00e7\u00f5es de seguran\u00e7a; depois desse per\u00edodo deve-se fazer o upgrade da distribui\u00e7\u00e3o. Gerir as Aplica\u00e7\u00f5es O sistema descrito em Arquitectura do Sistema pode ser gerido utilizando comandos standard de docker compose , desde a raiz do projeto (a pasta onde se encontra o ficheiro docker-compose.yml). Iniciar as aplica\u00e7\u00f5es (em background): docker compose up -d Visualizar os logs em tempo real: docker compose logs --follow Parar as aplica\u00e7\u00f5es: docker compose down Reiniciar as aplica\u00e7\u00f5es: docker compose restart Actualizar as Aplica\u00e7\u00f5es O c\u00f3digo do sistema descrito em Arquitectura do Sistema encontra-se num reposit\u00f3rio de git . Para instalar actualiza\u00e7\u00f5es, \u00e9 necess\u00e1rio descarregar as mudan\u00e7as desde o reposit\u00f3rio original, fazer o build dos containers caso necess\u00e1rio e voltar a lan\u00e7ar os containers. Descarregar as mudan\u00e7as remotas para o reposit\u00f3rio local: git pull . Parar as aplica\u00e7\u00f5es (ver Gerir as Aplica\u00e7\u00f5es ). Fazer o build das imagens de docker: docker compose build . Iniciar as aplica\u00e7\u00f5es (em background) (ver Gerir as Aplica\u00e7\u00f5es ). Tip O sistema usa algumas imagens de base que podem beneficiar de actualiza\u00e7\u00f5es. Essas imagens podem ser actualizadas usando o comando docker compose pull e depois reiniciando as aplica\u00e7\u00f5es (ver Gerir as Aplica\u00e7\u00f5es ). Assegurar-se de que o GHC consegue aceder ao Apache De cada vez que os containers s\u00e3o criados de novo (por exemplo, com um restart do servidor), \u00e9 importante assegurar-se de que o container GHC consegue aceder a https://ogcapi.dgterritorio.gov.pt/ . Se n\u00e3o for assim, o GHC vai falhar a monitoriza\u00e7\u00e3o dos servi\u00e7os, assumindo que eles n\u00e3o est\u00e3o a funcionar. Os passos para resolver esta situa\u00e7\u00e3o est\u00e3o descritos aqui . Substitui\u00e7\u00e3o dos certificados SSL Os certificados SSL est\u00e3o guardados na pasta /etc/cert . No caso de instalar novos certificados com o mesmo nome, ser\u00e1 necess\u00e1rio parar as aplica\u00e7\u00f5es e voltar a iniciar-las, para que os volumes dos containers sejam criados de novo, j\u00e1 com os novos certificados. No caso de os certificados terem nomes diferentes ou estarem noutra localiza\u00e7\u00e3o, \u00e9 necess\u00e1rio tamb\u00e9m actualizar o mapping no docker-compose.yml para reflectir essas mudan\u00e7as: - /etc/cert/2ogcapi.pem:/usr/local/apache2/conf/ogcapi/fullchain.pem - /etc/cert/ogcapi_privkey4.pem:/usr/local/apache2/conf/ogcapi/privkey.pem - /etc/cert/2logs.pem:/usr/local/apache2/conf/matomo/fullchain.pem - /etc/cert/logs_privkey4.pem:/usr/local/apache2/conf/matomo/privkey.pem - /etc/cert/1ghc.pem:/usr/local/apache2/conf/health/fullchain.pem - /etc/cert/ghc_privkey1.pem:/usr/local/apache2/conf/health/privkey.pem Tip Em cada uma destas strings de YAML , a primeira parte (antes do : ) representa o caminho e nome da chave publica ou privada do certificado (por exemplo, /etc/cert/2ogcapi.pem ). Contribuir Mudan\u00e7as nas Aplica\u00e7\u00f5es Contribui\u00e7oes para o c\u00f3digo do sistema, incluindo altera\u00e7\u00f5es ao ficheiro docker-compose.yml devem ser feitas directamente no reposit\u00f3rio git , atrav\u00e9s dos mecanismos normais de contribui\u00e7\u00e3o do git.","title":"Tarefas de Manuten\u00e7\u00e3o"},{"location":"tarefas/#tarefas-de-manutencao","text":"Esta sec\u00e7\u00e3o descreve algumas tarefas comuns de manuten\u00e7\u00e3o do servidor e da aplica\u00e7\u00e3o. Danger A leitura desta sec\u00e7\u00e3o n\u00e3o substitui a aprendizagem de como gerir uma m\u00e1quina de linux, e como usar docker, docker compose ou git. S\u00e3o providenciados alguns recursos sobre este tema na sec\u00e7\u00e3o Refer\u00eancias e Recursos de Aprendizagem .","title":"Tarefas de Manuten\u00e7\u00e3o"},{"location":"tarefas/#manutencao-do-servidor","text":"O servidor dever\u00e1 ser actualizado de forma regular, seguindo as boas pr\u00e1ticas de gest\u00e3o de uma m\u00e1quina de Linux: sudo apt-get update sudo apt-get upgrade Algumas actualiza\u00e7\u00f5es updates podem requerer o restart da m\u00e1quina. Warning As LTS proporcionam 5 anos de actualiza\u00e7\u00f5es de seguran\u00e7a; depois desse per\u00edodo deve-se fazer o upgrade da distribui\u00e7\u00e3o.","title":"Manuten\u00e7\u00e3o do Servidor"},{"location":"tarefas/#gerir-as-aplicacoes","text":"O sistema descrito em Arquitectura do Sistema pode ser gerido utilizando comandos standard de docker compose , desde a raiz do projeto (a pasta onde se encontra o ficheiro docker-compose.yml). Iniciar as aplica\u00e7\u00f5es (em background): docker compose up -d Visualizar os logs em tempo real: docker compose logs --follow Parar as aplica\u00e7\u00f5es: docker compose down Reiniciar as aplica\u00e7\u00f5es: docker compose restart","title":"Gerir as Aplica\u00e7\u00f5es"},{"location":"tarefas/#actualizar-as-aplicacoes","text":"O c\u00f3digo do sistema descrito em Arquitectura do Sistema encontra-se num reposit\u00f3rio de git . Para instalar actualiza\u00e7\u00f5es, \u00e9 necess\u00e1rio descarregar as mudan\u00e7as desde o reposit\u00f3rio original, fazer o build dos containers caso necess\u00e1rio e voltar a lan\u00e7ar os containers. Descarregar as mudan\u00e7as remotas para o reposit\u00f3rio local: git pull . Parar as aplica\u00e7\u00f5es (ver Gerir as Aplica\u00e7\u00f5es ). Fazer o build das imagens de docker: docker compose build . Iniciar as aplica\u00e7\u00f5es (em background) (ver Gerir as Aplica\u00e7\u00f5es ). Tip O sistema usa algumas imagens de base que podem beneficiar de actualiza\u00e7\u00f5es. Essas imagens podem ser actualizadas usando o comando docker compose pull e depois reiniciando as aplica\u00e7\u00f5es (ver Gerir as Aplica\u00e7\u00f5es ).","title":"Actualizar as Aplica\u00e7\u00f5es"},{"location":"tarefas/#assegurar-se-de-que-o-ghc-consegue-aceder-ao-apache","text":"De cada vez que os containers s\u00e3o criados de novo (por exemplo, com um restart do servidor), \u00e9 importante assegurar-se de que o container GHC consegue aceder a https://ogcapi.dgterritorio.gov.pt/ . Se n\u00e3o for assim, o GHC vai falhar a monitoriza\u00e7\u00e3o dos servi\u00e7os, assumindo que eles n\u00e3o est\u00e3o a funcionar. Os passos para resolver esta situa\u00e7\u00e3o est\u00e3o descritos aqui .","title":"Assegurar-se de que o GHC consegue aceder ao Apache"},{"location":"tarefas/#substituicao-dos-certificados-ssl","text":"Os certificados SSL est\u00e3o guardados na pasta /etc/cert . No caso de instalar novos certificados com o mesmo nome, ser\u00e1 necess\u00e1rio parar as aplica\u00e7\u00f5es e voltar a iniciar-las, para que os volumes dos containers sejam criados de novo, j\u00e1 com os novos certificados. No caso de os certificados terem nomes diferentes ou estarem noutra localiza\u00e7\u00e3o, \u00e9 necess\u00e1rio tamb\u00e9m actualizar o mapping no docker-compose.yml para reflectir essas mudan\u00e7as: - /etc/cert/2ogcapi.pem:/usr/local/apache2/conf/ogcapi/fullchain.pem - /etc/cert/ogcapi_privkey4.pem:/usr/local/apache2/conf/ogcapi/privkey.pem - /etc/cert/2logs.pem:/usr/local/apache2/conf/matomo/fullchain.pem - /etc/cert/logs_privkey4.pem:/usr/local/apache2/conf/matomo/privkey.pem - /etc/cert/1ghc.pem:/usr/local/apache2/conf/health/fullchain.pem - /etc/cert/ghc_privkey1.pem:/usr/local/apache2/conf/health/privkey.pem Tip Em cada uma destas strings de YAML , a primeira parte (antes do : ) representa o caminho e nome da chave publica ou privada do certificado (por exemplo, /etc/cert/2ogcapi.pem ).","title":"Substitui\u00e7\u00e3o dos certificados SSL"},{"location":"tarefas/#contribuir-mudancas-nas-aplicacoes","text":"Contribui\u00e7oes para o c\u00f3digo do sistema, incluindo altera\u00e7\u00f5es ao ficheiro docker-compose.yml devem ser feitas directamente no reposit\u00f3rio git , atrav\u00e9s dos mecanismos normais de contribui\u00e7\u00e3o do git.","title":"Contribuir Mudan\u00e7as nas Aplica\u00e7\u00f5es"},{"location":"tecnologias/","text":"Tecnologias Este sistema foi desenvolvido com recurso a tecnologias de software livre e de c\u00f3digo aberto. O servidor \u00e9 uma m\u00e1quina de Linux, que \u00e0 data de escrita deste manual tem o Ubuntu 24.04.2 LTS (Noble) instalado. \u00c9 recomendado adoptar releases LTS (Long Term Support) pela sua estabilidade, e tamb\u00e9m porque t\u00eam um suporte mais longo do que as vers\u00f5es Standard. O servidor tem habilitado um servidor de SSH (Secure shell) , que permite aceder de forma segura ao terminal e efectuar todas as opera\u00e7\u00f5es descritas neste manual. A Infra Estrutura de Dados (IDE) OGC API da DGT, de aqui em diante designada OGCAPI - DGT, est\u00e1 implementada utilizando m\u00e1quinas virtuais (docker containers), que s\u00e3o orquestradas usando docker compose. Docker \u00e9 uma plataforma para desenvolver, empacotar e correr aplica\u00e7\u00f5es. O Docker permite descrever a \"infraestrutura como c\u00f3digo\", e desta forma assegurar a reproducibilidade do sistema. Isso permite abstrair de uma infraestrutura espec\u00edfica, possibilitando a instala\u00e7\u00e3o em servidores de cloud ou nativos de diferentes provedores. O docker compose \u00e9 uma ferramenta que permite gerir aplica\u00e7\u00f5es que envolvem v\u00e1rios containers de docker. Os servi\u00e7os, volumes e redes podem ser descritos num \u00fanico ficheiro de configura\u00e7\u00e3o, e todo o sistema pode ser iniciado, reiniciado ou terminado com comandos simples. No pr\u00f3ximo cap\u00edtulo \u00e9 descrita a arquitectura da IDE, que est\u00e1 definida nos ficheiros de configura\u00e7\u00e3o do docker compose.","title":"Tecnologias Utilizadas"},{"location":"tecnologias/#tecnologias","text":"Este sistema foi desenvolvido com recurso a tecnologias de software livre e de c\u00f3digo aberto. O servidor \u00e9 uma m\u00e1quina de Linux, que \u00e0 data de escrita deste manual tem o Ubuntu 24.04.2 LTS (Noble) instalado. \u00c9 recomendado adoptar releases LTS (Long Term Support) pela sua estabilidade, e tamb\u00e9m porque t\u00eam um suporte mais longo do que as vers\u00f5es Standard. O servidor tem habilitado um servidor de SSH (Secure shell) , que permite aceder de forma segura ao terminal e efectuar todas as opera\u00e7\u00f5es descritas neste manual. A Infra Estrutura de Dados (IDE) OGC API da DGT, de aqui em diante designada OGCAPI - DGT, est\u00e1 implementada utilizando m\u00e1quinas virtuais (docker containers), que s\u00e3o orquestradas usando docker compose. Docker \u00e9 uma plataforma para desenvolver, empacotar e correr aplica\u00e7\u00f5es. O Docker permite descrever a \"infraestrutura como c\u00f3digo\", e desta forma assegurar a reproducibilidade do sistema. Isso permite abstrair de uma infraestrutura espec\u00edfica, possibilitando a instala\u00e7\u00e3o em servidores de cloud ou nativos de diferentes provedores. O docker compose \u00e9 uma ferramenta que permite gerir aplica\u00e7\u00f5es que envolvem v\u00e1rios containers de docker. Os servi\u00e7os, volumes e redes podem ser descritos num \u00fanico ficheiro de configura\u00e7\u00e3o, e todo o sistema pode ser iniciado, reiniciado ou terminado com comandos simples. No pr\u00f3ximo cap\u00edtulo \u00e9 descrita a arquitectura da IDE, que est\u00e1 definida nos ficheiros de configura\u00e7\u00e3o do docker compose.","title":"Tecnologias"}]}